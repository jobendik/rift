<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>RIFT</title>
  <link rel="icon" type="image/x-icon" href="./rift_logo.ico">
  
  <!-- Load your existing CSS structure -->
  <link rel="stylesheet" href="./styles/index.css">
  
  <!-- Add Google Fonts for better typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="loadingScreen">
    <div class="loading-container">
      <div class="logo">RIFT</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar"></div>
      </div>
      <div class="loading-text" id="loadingText">Loading...</div>
    </div>
  </div>

  <div id="startScreen" class="hidden">
    <div class="start-container">
      <div class="title">RIFT</div>
      <div class="start-button" id="start">START</div>
      <div class="instructions">
        <p>WASD to move</p>
        <p>Mouse to look</p>
        <p>Left click to shoot</p>
        <p>R to reload</p>
        <p>1,2,3 to switch weapons</p>
        <p>ESC to pause</p>
      </div>
    </div>
  </div>

  <div id="pauseScreen" class="hidden">
    <div class="pause-container">
      <div class="title">PAUSED</div>
      <div class="resume-button" id="resumeButton">RESUME</div>
      <div class="instructions">
        <p>WASD to move</p>
        <p>Mouse to look</p>
        <p>Left click to shoot</p>
        <p>R to reload</p>
        <p>1,2,3 to switch weapons</p>
        <p>ESC to pause</p>
      </div>
    </div>
  </div>

  <!-- Remove old UI elements - the new UI system will create these dynamically -->

  <div id="deathScreen" class="hidden">
    <div class="death-container">
      <div class="title">YOU DIED</div>
      <div class="restart-button" id="quitButton">RESTART</div>
    </div>
  </div>
  
  <div id="game-container"></div>
  
  <div id="pointerLockOverlay" class="hidden">
    <div class="overlay-content">
      <p>Click to resume game</p>
    </div>
  </div>
  
  <div id="devTools" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; z-index: 9999; display: none;">
    <div style="margin-bottom: 5px; color: #e63946; font-family: 'Orbitron', sans-serif; font-size: 14px;">RIFT Developer Tools</div>
    <ul style="list-style: none; margin: 0; padding: 0;">
      <li style="margin-bottom: 3px;"><a href="event-test.html" style="color: #fff; text-decoration: none; font-size: 12px;" target="_blank">Event Test Page</a></li>
      <li style="margin-bottom: 3px;"><a href="event-standardization-index.html" style="color: #fff; text-decoration: none; font-size: 12px;" target="_blank">Event Standardization Index</a></li>
      <li><a href="event-performance-monitor.html" style="color: #fff; text-decoration: none; font-size: 12px;" target="_blank">Event Performance Monitor</a></li>
    </ul>
  </div>

  <script type="module" src="./src/main.js"></script>
  
  <!-- Debug injection -->
  <script>
    function runDebugCheck() {
      console.log('🔍 RIFT DEBUG: Checking UI integration...');
      
      // Check global objects
      const globals = ['world', 'scene', 'camera', 'player', 'EventManager'];
      globals.forEach(global => {
        if (window[global]) {
          console.log(`✅ window.${global} exists`);
          if (global === 'world' && window.world.player) {
            console.log(`✅ world.player exists`);
            if (window.world.player.weaponSystem) {
              console.log(`✅ world.player.weaponSystem exists`);
              if (window.world.player.weaponSystem.currentWeapon) {
                const weapon = window.world.player.weaponSystem.currentWeapon;
                console.log(`✅ Current weapon: ${weapon.type || 'unknown'}, Ammo: ${weapon.roundsLeft}/${weapon.roundsPerClip}`);
              } else {
                console.log(`⚠️ world.player.weaponSystem.currentWeapon is null`);
              }
            } else {
              console.log(`❌ world.player.weaponSystem missing`);
            }
          }
        } else {
          console.log(`❌ window.${global} missing`);
        }
      });
      
      // Check UI elements
      const hudElements = document.querySelectorAll('[class*="rift-"]');
      console.log(`Found ${hudElements.length} RIFT UI elements in DOM`);
      hudElements.forEach((el, i) => {
        console.log(`  ${i+1}. ${el.className} (${el.tagName})`);
      });
      
      // Check for ammo display specifically
      const ammoDisplay = document.querySelector('.rift-ammo, #ammo-display');
      if (ammoDisplay) {
        console.log(`✅ Ammo display found: "${ammoDisplay.textContent}"`);
      } else {
        console.log('❌ Ammo display element NOT found in DOM');
      }
      
      // Check UIManager
      if (window.world && window.world.uiManager) {
        console.log('✅ UIManager exists');
        const uiManager = window.world.uiManager;
        if (uiManager.components) {
          console.log(`✅ UIManager has ${Object.keys(uiManager.components).length} components`);
          Object.keys(uiManager.components).forEach(key => {
            console.log(`  - ${key}: ${uiManager.components[key].constructor.name}`);
          });
        }
        if (uiManager.ammoDisplay) {
          console.log('✅ UIManager.ammoDisplay exists');
        } else {
          console.log('❌ UIManager.ammoDisplay missing');
        }
      } else {
        console.log('❌ UIManager missing');
      }
    }

    // Continuous monitoring for world creation
    let debugInterval = setInterval(() => {
      if (window.world && window.world.player) {
        console.log('🎯 World and player detected! Running debug check...');
        clearInterval(debugInterval);
        setTimeout(runDebugCheck, 2000); // Wait 2 more seconds for UI to initialize
        
        // Also check weapon properties specifically
        setTimeout(() => {
          if (window.world.player.weaponSystem && window.world.player.weaponSystem.currentWeapon) {
            const weapon = window.world.player.weaponSystem.currentWeapon;
            console.log('🔫 WEAPON DEBUG: Current weapon properties:');
            console.log('- roundsLeft:', weapon.roundsLeft);
            console.log('- roundsPerClip:', weapon.roundsPerClip);
            console.log('- ammo:', weapon.ammo);
            console.log('- totalRounds:', weapon.totalRounds);
            console.log('- type:', weapon.type);
            console.log('- All properties:', Object.keys(weapon));
          }
        }, 3000);
      }
    }, 1000);

    // Fallback: Allow manual debug trigger
    window.debugUI = runDebugCheck;
    console.log('💡 Tip: Type debugUI() in console to manually run debug check');
  </script>
</body>
</html>
